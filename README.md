Тема: Дисковая подсистема. Работа с mdadm.

Задача:

Подготовить Vagrantfile, скрипт для создания рейда, конфигурацию для автосборки рейда при загрузке

Для работы нам понадобятся:

1. Vagrant
2. Ansible
3. VirtualBox

1) Скачиваем из репозитория конфигурационные файлы:

apt update -y && apt install git -y
git clone https://github.com/pahami/mdadm.git

2) Создаём виртуальную машину. Для создания используем подготовленный Vagrantfile:

vagrant up

Чтобы проверить, что все настроено заходим на виртуальную машину и выполняем команды:

vagrant ssh
sudo -i
cat /proc/mdstat
cat /etc/mdadm/mdadm.conf

Для проверки правильности шаблона ansible можно использовать ключ --check

ansible-playbook -i staging/hosts site.yml --check

Если внесли изменения в playbook.yml, то используем:

vagrant provision

Комментарии к ключевым моментам playbook.yml:

1. Подготовка дисков: Перед созданием RAID массива важно обнулить супер-блоки на дисках, чтобы избежать конфликтов с предыдущими данными.
2. Создание RAID 5: Уровень RAID 5 выбран для повышения производительности чтения и записи данных, так как это оптимальный уровень для небольших массивов.
3. Создание файловой системы: После создания RAID массива необходимо создать файловую систему на нем. Ext4 — стандарт для современных Linux-систем.
4. Монтаж RAID: После создания файловой системы, RAID-массив монтируется в заранее созданный каталог /mnt/raid5.
5. Редактирование /etc/mdadm/mdadm.conf: В конце плейбука производится запись информации о созданном RAID-массиве в файл /etc/mdadm/mdadm.conf, чтобы система знала, как обращаться с ним при загрузке.
6. Обновление initramfs: После внесения изменений в конфигурацию, обновляется начальный RAM-диск для обеспечения совместимости с новыми изменениями.
7. Добавление точки монтирования в /etc/fstab: Для автоматической монтировки RAID-массива при загрузке системы.
